<!DOCTYPE html>
    <html class="flex h-full w-full flex-col flex-nowrap" lang="en">
      <head>
        <link rel="stylesheet" type="text/css" href="https://vchirikov.ru/assets/style.f2262c92.css">
        <script>document.documentElement.setAttribute('data-theme',window.localStorage.getItem('theme'))</script>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="color-scheme" content="dark light" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://vchirikov.ru/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="https://vchirikov.ru/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="https://vchirikov.ru/favicon-16x16.png" />
        <link rel="icon" href="https://vchirikov.ru/favicon.ico" />
        <link rel="manifest" href="https://vchirikov.ru/site.webmanifest" />
        <script>(e=>{let t=e=>e&&e.hasAttribute&&(e.hasAttribute("data-hk")?e:t(e.host&&e.host instanceof Node?e.host:e.parentNode));["click", "input"].forEach((o=>document.addEventListener(o,(o=>{let s=o.composedPath&&o.composedPath()[0]||o.target,a=t(s);a&&!e.completed.has(a)&&e.events.push([a,o])}))))})(window._$HY||(_$HY={events:[],completed:new WeakSet,r:{},fe(){},init(e,t){_$HY.r[e]=[new Promise((e=>t=e)),t]},set(e,t,o){(o=_$HY.r[e])&&o[1](t),_$HY.r[e]=[t]},unset(e){delete _$HY.r[e]},load:e=>_$HY.r[e]}));</script><!--xs-->
        <title data-sm="0-0-0-0-0-0-0-6-1-0-0-0">HAProxy W3C traceparent | Vladimir Chirikov</title><meta data-sm="0-0-0-0-0-0-0-6-1-0-1-0" name="description" content="How to configure generation of W3C traceparent header (opentelemetry) on HAProxy"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-2-0" name="author" content="Vladimir Chirikov"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-3-0" property="og:url" content="https://vchirikov.ru/post/haproxy-w3c-traceparent/"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-4-0" property="og:title" content="HAProxy W3C traceparent. How to configure generation of W3C traceparent header (opentelemetry) on HAProxy"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-5-0" property="og:description" content="How to configure generation of W3C traceparent header (opentelemetry) on HAProxy"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-6-0" property="og:locale" content="en"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-7-0" property="og:site_name" content="Vladimir Chirikov"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-9-0-0" property="og:type" content="article"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-9-1-0" property="og:image" content="https://vchirikov.ru/assets/img/generated/en/haproxy-w3c-traceparent/1e860852ca46a9ac4e53686be3b8ed56cbbe5981.og.png"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-9-2-0" name="twitter:card" content="summary_large_image"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-9-3-0" property="article:published_time" content="2022-11-29T00:00:00.000Z"/><meta data-sm="0-0-0-0-0-0-0-6-1-0-9-4-0" property="article:modified_time" content="2022-11-29T00:00:00.000Z"/>
      </head>
      <body class="flex flex-1 flex-col flex-nowrap">
        <div id="app"><!e0-0-0-0-0-0-0><div data-hk="0-0-0-0-0-0-0-0" class="drawer drawer-end"><input id="drawer" type="checkbox" class="drawer-toggle"><!--#--><input data-hk="0-0-0-0-0-0-0-1-0" type="checkbox" id="search-modal" class="modal-toggle"><label data-hk="0-0-0-0-0-0-0-1-1" for="search-modal" class="modal cursor-pointer"><label class="modal-box border-base-content/5 relative flex max-h-[83%] min-h-[50%] w-11/12 max-w-5xl flex-col items-stretch border p-0 shadow" for=""><div class="bg-base-300 flex h-14 flex-row flex-nowrap items-center justify-between"><div class="form-control ml-4 h-14 flex-1 justify-center"><div class="h-9"><input data-hk="0-0-0-0-0-0-0-1-2-0" tabindex="0" type="text" placeholder="Search" class="input-bordered input h-full w-full opacity-50 transition-opacity hover:opacity-80 focus:opacity-80"></div></div><label for="search-modal" class="btn-sm btn-circle btn mx-2">✕</label></div><div class="bg-base-200 flex w-full flex-1 flex-col flex-nowrap overscroll-none"><div data-hk="0-0-0-0-0-0-0-1-3-0-3" class="flex flex-1 flex-row flex-nowrap items-center justify-center"><div><!--#-->Type a query into the input<!--/-->&nbsp;<pre class="kbd kbd-md text-primary inline">^^^</pre></div></div></div></label></label><!--/--><div class="drawer-content flex flex-1 flex-col flex-nowrap items-stretch"><div class="navbar border-base-content/5 bg-base-100 shadow-base-content z-10 select-none border-b drop-shadow-lg"><div class="flex-1"><!--#--><a data-hk="0-0-0-0-0-0-0-2-0" tabIndex="0" href="/en/" class="btn-ghost btn-circle avatar btn" ><div data-hk="0-0-0-0-0-0-0-2-1" class="w-12 rounded-full"><img alt="ava" src="https://vchirikov.ru/assets/img/ava.jpg"></div></a><!--/--><!--#--><a data-hk="0-0-0-0-0-0-0-3-0" href="/en/" class="prose-sm prose md:prose-xl mx-2 font-semibold" >Vladimir Chirikov</a><!--/--></div><div class="block sm:hidden"><label for="drawer" class="drawer-button btn btn-sm btn-ghost"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></label></div><div class="hidden flex-row-reverse gap-2 sm:flex"><label for="search-modal" class="input-bordered input h-9 select-none leading-9 opacity-50 transition-opacity hover:opacity-80 focus:opacity-80 sm:w-32 md:w-48 lg:w-64">Search</label><div class="flex flex-row items-center"><!--#--><div data-hk="0-0-0-0-0-0-0-4-0" class="opacity-50 transition-opacity hover:opacity-80"><a data-hk="0-0-0-0-0-0-0-4-1-0" href="/en/post/haproxy-w3c-traceparent" class="btn-xs btn m-1 active" aria-current="page">EN</a></div><div data-hk="0-0-0-0-0-0-0-4-2" class="opacity-50 transition-opacity hover:opacity-80"><a data-hk="0-0-0-0-0-0-0-4-3-0" href="/ru/post/haproxy-w3c-traceparent" class="btn-xs btn m-1 active" aria-current="page">RU</a></div><!--/--><!--#--><div data-hk="0-0-0-0-0-0-0-5-0" class="dropdown-end dropdown px-1"><label tabindex="0" class="link text-current opacity-40 hover:text-current hover:opacity-80"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.334 14c.584 2.239 2.001 2.547 2.001 4.02 0 1.094-.896 1.98-2.001 1.98-1.104 0-2.015-.887-2.015-1.98 0-1.473 1.432-1.781 2.015-4.02zm12.666-2c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5.205-7.316l-2.641 2.316h2.791l1.085-.935c-.37-.498-.782-.96-1.235-1.381zm3.205 7.316c0-1.527-.354-2.969-.969-4.265l-4.486 3.902c-1.402 1.226-2.126.041-3.911 1.091-.237.141-.486.185-.71.158-.566-.07-1.018-.594-.941-1.216.024-.205.113-.419.267-.633 1.128-1.571.183-2.49 1.553-3.68l4.435-3.86c-1.527-.943-3.317-1.497-5.238-1.497-5.514 0-10 4.486-10 10s4.486 10 10 10 10-4.486 10-10z"></path></svg></label><div tabindex="0" class="dropdown-content rounded-box btn-group btn-group-vertical bg-base-100 mt-2 w-28 p-0 shadow"><button class="btn-ghost btn">Dark</button><button class="btn-active btn">Light</button><button class="btn-ghost btn">Berloga</button></div></div><!--/--></div></div></div><div class="bg-base-300 flex flex-1 flex-col flex-nowrap"><div class="border-secondary-content/5 bg-base-100 m-3 mx-auto w-full max-w-[78rem] flex-1 rounded-md border shadow"><div data-hk="0-0-0-0-0-0-0-6-0" class="flex flex-1 flex-col flex-nowrap pb-3"><script data-hk="0-0-0-0-0-0-0-6-1-0-9-5" type="application/ld+json">
        {
          "description": "How to configure generation of W3C traceparent header (opentelemetry) on HAProxy",
          "author": {
            "@type": "Person",
            "name": "Vladimir Chirikov"
          },
          "@type": "BlogPosting",
          "url": "https://vchirikov.ru/post/haproxy-w3c-traceparent/",
          "publisher": {
            "@type": "Organization",
            "logo": {
              "@type": "ImageObject",
              "url": "https://vchirikov.ru/assets/img/generated/en/haproxy-w3c-traceparent/1e860852ca46a9ac4e53686be3b8ed56cbbe5981.og.png"
            },
            "name": "Vladimir Chirikov"
          },
          "headline": "HAProxy W3C traceparent | Vladimir Chirikov",
          "image": ["https://vchirikov.ru/assets/img/generated/en/haproxy-w3c-traceparent/1e860852ca46a9ac4e53686be3b8ed56cbbe5981"],
          "datePublished": "2022-11-29T00:00:00.000Z",
          "dateModified": "2022-11-29T00:00:00.000Z",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://vchirikov.ru/post/haproxy-w3c-traceparent/"
          },
          "@context": "http://schema.org"
        }</script><figure data-hk="0-0-0-0-0-0-0-6-1-1" class="w-full select-none"><img class="w-full rounded rounded-t-md" alt="image for post" src="https://vchirikov.ru/assets/img/generated/en/haproxy-w3c-traceparent/1e860852ca46a9ac4e53686be3b8ed56cbbe5981.svg"></figure><div data-hk="0-0-0-0-0-0-0-6-1-2" class="text mt-3 flex w-full flex-row items-center justify-between px-4 text-sm"><!--#--><div data-hk="0-0-0-0-0-0-0-6-1-3-0" class="breadcrumbs text-sm"><ul><li><a data-hk="0-0-0-0-0-0-0-6-1-3-1-0" href="https://vchirikov.ru" rel="nofollow external" class="opacity-80 transition-opacity hover:opacity-100 focus:opacity-100" ><svg data-hk="0-0-0-0-0-0-0-6-1-3-1-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="mr-2 h-4 w-4 stroke-current"><path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>Index</a></li><li><a data-hk="0-0-0-0-0-0-0-6-1-3-2-0" href="/en/post/haproxy-w3c-traceparent" class="active" aria-current="page"><svg data-hk="0-0-0-0-0-0-0-6-1-3-2-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="mr-2 h-4 w-4 stroke-current"><path d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>HAProxy W3C traceparent</a></li></ul></div><!--/--><button class="btn btn-xs btn-ghost gap-2"><!--#-->Back<!--/--><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"></path></svg></button></div><article data-hk="0-0-0-0-0-0-0-6-1-4" class="prose-neutral prose prose-img:mx-auto prose-img:select-none mt-6 h-full w-full max-w-none px-3 lg:px-5"><!e0-0-0-0-0-0-0-6-1-5-0><div data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-0"><h1 data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-3-0" id="haproxy--w3c-traceparent" ><a data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-2-0" class="anchor " aria-hidden="true" tabindex="-1" href="#haproxy--w3c-traceparent" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-1-0" class="icon icon-link "></span></a>HAProxy + W3C traceparent</h1>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-5-0" >Opentelemetry contributers created a W3C draft about <a data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-4-0" href="https://w3c.github.io/trace-context/#traceparent-header-field-values" target="_blank" rel="noopener noreferrer" >traceparent</a>.</p>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-8-0" >HAProxy has settings related to request-id, you can specify <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-6-0" >unique-id-format</code> / <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-7-0" >unique-id-header</code>, although
you can't use w3c traceparent out of the box, so let's read the standard.</p>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-13-0" >TLDR: <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-9-0" >traceparent</code> looks like: <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-10-0" >00-0af7651916cd43dd8448eb211c80319c-00f067aa0ba902b7-01</code> and has the format:<br data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-11-0" />
<code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-12-0" >${version}-${trace-id}-${parent-id}-${trace-flags}</code>.</p>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-18-0" >traceparent version is always <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-14-0" >00</code> (there is no other versions yet).
<code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-15-0" >trace-flag</code> - are 2 flags. Least significant bit, right-most is a sampling indicator and another is indicator of randomness
in <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-16-0" >trace-id</code>.  HAProxy won't do anything about sampling in my case, thus we can hardcode the flag value <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-17-0" >03</code>.</p>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-20-0" >I won't parce incomming traceparent (you can add it if you need), thus we should generate header in forma: <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-19-0" >00-${rand_32_hex}c-${rand_16_hex}-03</code> на HAProxy.</p>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-23-0" >In HAProxy configuration as generator of random strings we can use <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-21-0" >uuid(4)</code> <a data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-22-0" href="https://www.rfc-editor.org/rfc/rfc4122.html" target="_blank" rel="noopener noreferrer" >RFC 4122</a>.</p>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-24-0" >Let's go..</p>
<h2 data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-27-0" id="install--practice" ><a data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-26-0" class="anchor " aria-hidden="true" tabindex="-1" href="#install--practice" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-25-0" class="icon icon-link "></span></a>Install &amp; Practice</h2>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-30-0" >Let's create a helm chart config
<a data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-28-0" href="https://github.com/haproxy-ingress/charts/blob/master/haproxy-ingress/values.yaml" target="_blank" rel="noopener noreferrer" >haproxy-ingress</a>,
file <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-29-0" >haproxy-traceparent.yaml</code>:</p>
<pre data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-170-0" class="language-yaml " ><code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-169-0" class="language-yaml code-highlight " ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-33-0" class="code-line line-number " line="1" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-31-0" class="token key atrule " >serviceAccount</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-32-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-37-0" class="code-line line-number " line="2" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-34-0" class="token key atrule " >create</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-35-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-36-0" class="token boolean important " >false</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-40-0" class="code-line line-number " line="3" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-38-0" class="token key atrule " >controller</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-39-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-43-0" class="code-line line-number " line="4" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-41-0" class="token key atrule " >ingressClass</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-42-0" class="token punctuation " >:</span> haproxy
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-46-0" class="code-line line-number " line="5" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-44-0" class="token key atrule " >ingressClassResource</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-45-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-50-0" class="code-line line-number " line="6" >    <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-47-0" class="token key atrule " >enabled</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-48-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-49-0" class="token boolean important " >true</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-54-0" class="code-line line-number " line="7" >    <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-51-0" class="token key atrule " >default</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-52-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-53-0" class="token boolean important " >false</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-58-0" class="code-line line-number " line="8" >    <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-55-0" class="token key atrule " >controllerClass</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-56-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-57-0" class="token string " >"haproxy"</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-60-0" class="code-line line-number " line="9" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-59-0" class="token comment " ># [Configuration keys](https://haproxy-ingress.github.io/docs/configuration/keys/#keys)</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-63-0" class="code-line line-number " line="10" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-61-0" class="token key atrule " >config</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-62-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-68-0" class="code-line line-number " line="11" >    <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-64-0" class="token key atrule " >config-frontend</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-65-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-66-0" class="token punctuation " >|</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-67-0" class="token punctuation " >-</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-70-0" class="code-line line-number " line="12" >      <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-69-0" class="token comment " ># parse UUID [RFC 4122](https://www.rfc-editor.org/rfc/rfc4122.html)</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-109-0" class="code-line line-number " line="13" >      http<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-71-0" class="token punctuation " >-</span>request set<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-72-0" class="token punctuation " >-</span>var(txn.trace_id) uuid(4)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-73-0" class="token punctuation " >,</span>regsub(\"^(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-74-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-75-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-76-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-77-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-78-0" class="token number " >8</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-79-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-80-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-81-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-82-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-83-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-84-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-85-0" class="token number " >4</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-86-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-87-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-88-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-89-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-90-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-91-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-92-0" class="token number " >4</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-93-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-94-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-95-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-96-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-97-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-98-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-99-0" class="token number " >4</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-100-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-101-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-102-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-103-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-104-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-105-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-106-0" class="token number " >12</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-107-0" class="token punctuation " >}</span>)$\"<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-108-0" class="token punctuation " >,</span>\"\1\2\3\4\5\")
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-148-0" class="code-line line-number " line="14" >      http<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-110-0" class="token punctuation " >-</span>request set<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-111-0" class="token punctuation " >-</span>var(txn.parent_id) uuid(4)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-112-0" class="token punctuation " >,</span>regsub(\"^(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-113-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-114-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-115-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-116-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-117-0" class="token number " >8</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-118-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-119-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-120-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-121-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-122-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-123-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-124-0" class="token number " >4</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-125-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-126-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-127-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-128-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-129-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-130-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-131-0" class="token number " >4</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-132-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-133-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-134-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-135-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-136-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-137-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-138-0" class="token number " >4</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-139-0" class="token punctuation " >}</span>)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-140-0" class="token punctuation " >-</span>(<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-141-0" class="token punctuation " >[</span>^<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-142-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-143-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-144-0" class="token punctuation " >{</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-145-0" class="token number " >12</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-146-0" class="token punctuation " >}</span>)$\"<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-147-0" class="token punctuation " >,</span>\"\1\2\3\")
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-159-0" class="code-line line-number " line="15" >      unique<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-149-0" class="token punctuation " >-</span>id<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-150-0" class="token punctuation " >-</span>format 00<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-151-0" class="token punctuation " >-</span>%<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-152-0" class="token punctuation " >[</span>var(txn.trace_id)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-153-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-154-0" class="token punctuation " >-</span>%<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-155-0" class="token punctuation " >[</span>var(txn.parent_id)<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-156-0" class="token punctuation " >]</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-157-0" class="token punctuation " >-</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-158-0" class="token number " >03</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-162-0" class="code-line line-number " line="16" >      unique<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-160-0" class="token punctuation " >-</span>id<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-161-0" class="token punctuation " >-</span>header traceparent
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-164-0" class="code-line line-number " line="17" >      <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-163-0" class="token comment " ># return traceparent to the client</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-168-0" class="code-line line-number " line="18" >      http<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-165-0" class="token punctuation " >-</span>after<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-166-0" class="token punctuation " >-</span>response set<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-167-0" class="token punctuation " >-</span>header traceparent %ID
</span></code></pre>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-171-0" >Let's install HAProxy:</p>
<pre data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-178-0" class="language-bash " ><code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-177-0" class="language-bash code-highlight " ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-173-0" class="code-line line-number " line="1" >helm repo <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-172-0" class="token function " >add</span> haproxy-ingress https://haproxy-ingress.github.io/charts
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-176-0" class="code-line line-number " line="2" >helm upgrade <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-174-0" class="token parameter variable " >-i</span> haproxy haproxy-ingress/haproxy-ingress <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-175-0" class="token parameter variable " >-f</span> haproxy-traceparent.yaml
</span></code></pre>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-181-0" >Install <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-179-0" >podinfo</code> for testing,  <code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-180-0" >podinfo-local.yaml:</code></p>
<pre data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-211-0" class="language-yaml " ><code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-210-0" class="language-yaml code-highlight " ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-184-0" class="code-line line-number " line="1" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-182-0" class="token key atrule " >ingress</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-183-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-188-0" class="code-line line-number " line="2" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-185-0" class="token key atrule " >enabled</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-186-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-187-0" class="token boolean important " >true</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-192-0" class="code-line line-number " line="3" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-189-0" class="token key atrule " >className</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-190-0" class="token punctuation " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-191-0" class="token string " >"haproxy"</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-195-0" class="code-line line-number " line="4" >  <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-193-0" class="token key atrule " >hosts</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-194-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-199-0" class="code-line line-number " line="5" >    <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-196-0" class="token punctuation " >-</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-197-0" class="token key atrule " >host</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-198-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-202-0" class="code-line line-number " line="6" >      <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-200-0" class="token key atrule " >paths</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-201-0" class="token punctuation " >:</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-206-0" class="code-line line-number " line="7" >        <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-203-0" class="token punctuation " >-</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-204-0" class="token key atrule " >path</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-205-0" class="token punctuation " >:</span> /
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-209-0" class="code-line line-number " line="8" >          <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-207-0" class="token key atrule " >pathType</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-208-0" class="token punctuation " >:</span> ImplementationSpecific
</span></code></pre>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-212-0" >Install:</p>
<pre data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-219-0" class="language-bash " ><code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-218-0" class="language-bash code-highlight " ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-214-0" class="code-line line-number " line="1" >helm repo <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-213-0" class="token function " >add</span> podinfo https://stefanprodan.github.io/podinfo
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-217-0" class="code-line line-number " line="2" >helm upgrade <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-215-0" class="token parameter variable " >-i</span> podinfo podinfo/podinfo <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-216-0" class="token parameter variable " >-f</span> podinfo-local.yaml
</span></code></pre>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-220-0" >Done, let's test:</p>
<pre data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-263-0" class="language-bash " ><code data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-262-0" class="language-bash code-highlight " ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-223-0" class="code-line line-number " line="1" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-221-0" class="token function " >curl</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-222-0" class="token parameter variable " >-i</span> http://localhost:80/headers
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-224-0" class="code-line line-number " line="2" >
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-227-0" class="code-line line-number " line="3" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-225-0" class="token operator " >></span> HTTP/1.1 <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-226-0" class="token number " >200</span> OK
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-232-0" class="code-line line-number " line="4" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-228-0" class="token operator " >></span> content-type: application/json<span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-229-0" class="token punctuation " >;</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-230-0" class="token assign-left variable " >charset</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-231-0" class="token operator " >=</span>utf-8
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-234-0" class="code-line line-number " line="5" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-233-0" class="token operator " >></span> x-content-type-options: nosniff
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-237-0" class="code-line line-number " line="6" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-235-0" class="token operator " >></span> content-length: <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-236-0" class="token number " >358</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-239-0" class="code-line line-number " line="7" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-238-0" class="token operator " >></span> traceparent: 00-5e8097d048e64fd4a4fc1861d9032e17-6ee9491181244f5b-03
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-240-0" class="code-line line-number " line="8" >
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-243-0" class="code-line line-number " line="9" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-241-0" class="token operator " >></span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-242-0" class="token punctuation " >{</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-246-0" class="code-line line-number " line="10" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-244-0" class="token operator " >></span>   <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-245-0" class="token punctuation " >..</span>.
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-251-0" class="code-line line-number " line="11" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-247-0" class="token operator " >></span>   <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-248-0" class="token string " >"Traceparent"</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-249-0" class="token builtin class-name " >:</span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-250-0" class="token punctuation " >[</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-254-0" class="code-line line-number " line="12" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-252-0" class="token operator " >></span>     <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-253-0" class="token string " >"00-5e8097d048e64fd4a4fc1861d9032e17-6ee9491181244f5b-03"</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-257-0" class="code-line line-number " line="13" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-255-0" class="token operator " >></span>   <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-256-0" class="token punctuation " >]</span>,
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-260-0" class="code-line line-number " line="14" ><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-258-0" class="token operator " >></span> <span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-259-0" class="token punctuation " >}</span>
</span><span data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-261-0" class="code-line line-number " line="15" >
</span></code></pre>
<p data-hk="0-0-0-0-0-0-0-6-1-5-0-0-0-0-264-0" >Done.</p></div><!/e0-0-0-0-0-0-0-6-1-5-0></article></div></div></div><footer class="footer border-base-content/5 bg-neutral text-neutral-content shadow-base-content/20 flex flex-row flex-nowrap items-center justify-between border-t-2 py-2 px-4 md:px-6 lg:py-1"><div class="flex select-none flex-col text-xs leading-3"><p class="opacity-60 transition-opacity hover:opacity-80">Copyright © <!--#-->2023<!--/--></p><p class="opacity-20 transition-opacity hover:opacity-80">Version: <!--#-->0.2.24<!--/--></p></div><div class="flex flex-row flex-nowrap items-center"><a href="https://t.me/+RROSXUhWMNc3NDgy" class="opacity-50 transition-opacity hover:opacity-80 focus:opacity-80"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12,0c-6.627,0 -12,5.373 -12,12c0,6.627 5.373,12 12,12c6.627,0 12,-5.373 12,-12c0,-6.627 -5.373,-12 -12,-12Zm0,2c5.514,0 10,4.486 10,10c0,5.514 -4.486,10 -10,10c-5.514,0 -10,-4.486 -10,-10c0,-5.514 4.486,-10 10,-10Zm2.692,14.889c0.161,0.115 0.368,0.143 0.553,0.073c0.185,-0.07 0.322,-0.228 0.362,-0.42c0.435,-2.042 1.489,-7.211 1.884,-9.068c0.03,-0.14 -0.019,-0.285 -0.129,-0.379c-0.11,-0.093 -0.263,-0.12 -0.399,-0.07c-2.096,0.776 -8.553,3.198 -11.192,4.175c-0.168,0.062 -0.277,0.223 -0.271,0.4c0.006,0.177 0.125,0.33 0.296,0.381c1.184,0.354 2.738,0.847 2.738,0.847c0,0 0.725,2.193 1.104,3.308c0.047,0.139 0.157,0.25 0.301,0.287c0.145,0.038 0.298,-0.001 0.406,-0.103c0.608,-0.574 1.548,-1.461 1.548,-1.461c0,0 1.786,1.309 2.799,2.03Zm-5.505,-4.338l0.84,2.769l0.186,-1.754c0,0 3.243,-2.925 5.092,-4.593c0.055,-0.048 0.062,-0.13 0.017,-0.188c-0.045,-0.057 -0.126,-0.071 -0.188,-0.032c-2.143,1.368 -5.947,3.798 -5.947,3.798Z"></path></svg></a><a href="https://github.com/vchirikov" class="opacity-50 transition-opacity hover:opacity-80 focus:opacity-80"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 6c-3.313 0-6 2.686-6 6 0 2.651 1.719 4.9 4.104 5.693.3.056.396-.13.396-.289v-1.117c-1.669.363-2.017-.707-2.017-.707-.272-.693-.666-.878-.666-.878-.544-.373.041-.365.041-.365.603.042.92.619.92.619.535.917 1.403.652 1.746.499.054-.388.209-.652.381-.802-1.333-.152-2.733-.667-2.733-2.965 0-.655.234-1.19.618-1.61-.062-.153-.268-.764.058-1.59 0 0 .504-.161 1.65.615.479-.133.992-.199 1.502-.202.51.002 1.023.069 1.503.202 1.146-.776 1.648-.615 1.648-.615.327.826.121 1.437.06 1.588.385.42.617.955.617 1.61 0 2.305-1.404 2.812-2.74 2.96.216.186.412.551.412 1.111v1.646c0 .16.096.347.4.288 2.383-.793 4.1-3.041 4.1-5.691 0-3.314-2.687-6-6-6z"></path></svg></a><a href="https://twitter.com/0x4351" class="opacity-50 transition-opacity hover:opacity-80 focus:opacity-80"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.5 8.778c-.441.196-.916.328-1.414.388.509-.305.898-.787 1.083-1.362-.476.282-1.003.487-1.564.597-.448-.479-1.089-.778-1.796-.778-1.59 0-2.758 1.483-2.399 3.023-2.045-.103-3.86-1.083-5.074-2.572-.645 1.106-.334 2.554.762 3.287-.403-.013-.782-.124-1.114-.308-.027 1.14.791 2.207 1.975 2.445-.346.094-.726.116-1.112.042.313.978 1.224 1.689 2.3 1.709-1.037.812-2.34 1.175-3.647 1.021 1.09.699 2.383 1.106 3.773 1.106 4.572 0 7.154-3.861 6.998-7.324.482-.346.899-.78 1.229-1.274z"></path></svg></a></div></footer></div><div class="drawer-side"><label for="drawer" class="drawer-overlay"></label><div class="bg-base-100 text-base-content w-5/6 max-w-2xl"><div class="flex h-full w-full flex-col flex-nowrap items-center justify-start p-3"><label for="search-modal" class="input-bordered input mb-4 h-9 w-full select-none leading-9 opacity-50 transition-opacity hover:opacity-80 focus:opacity-80 ">Search</label><div class="w-full  font-mono text-sm"><!--#-->Settings<!--/-->:</div><div class="border-base-200/40 mt-2 flex w-full flex-row items-center justify-between border-y py-0"><div class="flex flex-row flex-nowrap items-center justify-start"><div data-hk="0-0-0-0-0-0-0-7-0" class="opacity-50 transition-opacity hover:opacity-80"><a data-hk="0-0-0-0-0-0-0-7-1-0" href="/en/post/haproxy-w3c-traceparent" class="btn-xs btn m-1 active" data-prefetch="false" aria-current="page">EN</a></div><div data-hk="0-0-0-0-0-0-0-7-2" class="opacity-50 transition-opacity hover:opacity-80"><a data-hk="0-0-0-0-0-0-0-7-3-0" href="/ru/post/haproxy-w3c-traceparent" class="btn-xs btn m-1 active" data-prefetch="false" aria-current="page">RU</a></div></div><!--#--><div data-hk="0-0-0-0-0-0-0-8-0" class="dropdown-end dropdown px-1"><label tabindex="0" class="link text-current opacity-40 hover:text-current hover:opacity-80"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.334 14c.584 2.239 2.001 2.547 2.001 4.02 0 1.094-.896 1.98-2.001 1.98-1.104 0-2.015-.887-2.015-1.98 0-1.473 1.432-1.781 2.015-4.02zm12.666-2c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5.205-7.316l-2.641 2.316h2.791l1.085-.935c-.37-.498-.782-.96-1.235-1.381zm3.205 7.316c0-1.527-.354-2.969-.969-4.265l-4.486 3.902c-1.402 1.226-2.126.041-3.911 1.091-.237.141-.486.185-.71.158-.566-.07-1.018-.594-.941-1.216.024-.205.113-.419.267-.633 1.128-1.571.183-2.49 1.553-3.68l4.435-3.86c-1.527-.943-3.317-1.497-5.238-1.497-5.514 0-10 4.486-10 10s4.486 10 10 10 10-4.486 10-10z"></path></svg></label><div tabindex="0" class="dropdown-content rounded-box btn-group btn-group-vertical bg-base-100 mt-2 w-28 p-0 shadow"><button class="btn-ghost btn">Dark</button><button class="btn-active btn">Light</button><button class="btn-ghost btn">Berloga</button></div></div><!--/--></div></div></div></div></div><!/e0-0-0-0-0-0-0></div>
        <script type="module" src="https://vchirikov.ru/assets/entry-server-routing.d7fa78fe.js" defer></script>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/src/pages/blog/post.page.05925518.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-4f12729c.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-b9674078.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-340acbf2.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-704646a9.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-afc3f033.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-5e8bbab2.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/src/pages/renderer/_default.page.client.4310c23a.js" as="script" type="text/javascript" crossorigin>
        <link rel="modulepreload" href="https://vchirikov.ru/assets/chunk-6b0f39a3.js" as="script" type="text/javascript" crossorigin>
        <script id="vite-plugin-ssr_pageContext" type="application/json">{"pageContext":{"_pageId":"/src/pages/blog/post","pageProps":{"locale":"en","post":{"matter":{"title":"HAProxy W3C traceparent","description":"How to configure generation of W3C traceparent header (opentelemetry) on HAProxy","date":"2022-11-29","modified_date":"2022-11-29","image":{"background":"_content/img/banners/haproxy.png","title":"HAProxy + W3C traceparent","text":"aka opentelemetry request id","theme":"light"}},"code":"/*@jsxRuntime automatic @jsxImportSource solid-jsx*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    a: \"a\",\n    span: \"span\",\n    p: \"p\",\n    code: \"code\",\n    br: \"br\",\n    h2: \"h2\",\n    pre: \"pre\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.h1, {\n      id: \"haproxy--w3c-traceparent\",\n      children: [_jsx(_components.a, {\n        class: \"anchor\",\n        \"aria-hidden\": true,\n        tabindex: \"-1\",\n        href: \"#haproxy--w3c-traceparent\",\n        children: _jsx(_components.span, {\n          class: \"icon icon-link\"\n        })\n      }), \"HAProxy + W3C traceparent\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Opentelemetry contributers created a W3C draft about \", _jsx(_components.a, {\n        href: \"https://w3c.github.io/trace-context/#traceparent-header-field-values\",\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        children: \"traceparent\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"HAProxy has settings related to request-id, you can specify \", _jsx(_components.code, {\n        children: \"unique-id-format\"\n      }), \" / \", _jsx(_components.code, {\n        children: \"unique-id-header\"\n      }), \", although\\nyou can't use w3c traceparent out of the box, so let's read the standard.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"TLDR: \", _jsx(_components.code, {\n        children: \"traceparent\"\n      }), \" looks like: \", _jsx(_components.code, {\n        children: \"00-0af7651916cd43dd8448eb211c80319c-00f067aa0ba902b7-01\"\n      }), \" and has the format:\", _jsx(_components.br, {}), \"\\n\", _jsx(_components.code, {\n        children: \"${version}-${trace-id}-${parent-id}-${trace-flags}\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"traceparent version is always \", _jsx(_components.code, {\n        children: \"00\"\n      }), \" (there is no other versions yet).\\n\", _jsx(_components.code, {\n        children: \"trace-flag\"\n      }), \" - are 2 flags. Least significant bit, right-most is a sampling indicator and another is indicator of randomness\\nin \", _jsx(_components.code, {\n        children: \"trace-id\"\n      }), \".  HAProxy won't do anything about sampling in my case, thus we can hardcode the flag value \", _jsx(_components.code, {\n        children: \"03\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I won't parce incomming traceparent (you can add it if you need), thus we should generate header in forma: \", _jsx(_components.code, {\n        children: \"00-${rand_32_hex}c-${rand_16_hex}-03\"\n      }), \" на HAProxy.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In HAProxy configuration as generator of random strings we can use \", _jsx(_components.code, {\n        children: \"uuid(4)\"\n      }), \" \", _jsx(_components.a, {\n        href: \"https://www.rfc-editor.org/rfc/rfc4122.html\",\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        children: \"RFC 4122\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's go..\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"install--practice\",\n      children: [_jsx(_components.a, {\n        class: \"anchor\",\n        \"aria-hidden\": true,\n        tabindex: \"-1\",\n        href: \"#install--practice\",\n        children: _jsx(_components.span, {\n          class: \"icon icon-link\"\n        })\n      }), \"Install & Practice\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Let's create a helm chart config\\n\", _jsx(_components.a, {\n        href: \"https://github.com/haproxy-ingress/charts/blob/master/haproxy-ingress/values.yaml\",\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        children: \"haproxy-ingress\"\n      }), \",\\nfile \", _jsx(_components.code, {\n        children: \"haproxy-traceparent.yaml\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      class: \"language-yaml\",\n      children: _jsxs(_components.code, {\n        class: \"language-yaml code-highlight\",\n        children: [_jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"1\",\n          children: [_jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"serviceAccount\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"2\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"create\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token boolean important\",\n            children: \"false\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"3\",\n          children: [_jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"controller\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"4\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"ingressClass\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" haproxy\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"5\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"ingressClassResource\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"6\",\n          children: [\"    \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"enabled\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token boolean important\",\n            children: \"true\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"7\",\n          children: [\"    \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"default\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token boolean important\",\n            children: \"false\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"8\",\n          children: [\"    \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"controllerClass\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token string\",\n            children: \"\\\"haproxy\\\"\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"9\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token comment\",\n            children: \"# [Configuration keys](https://haproxy-ingress.github.io/docs/configuration/keys/#keys)\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"10\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"config\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"11\",\n          children: [\"    \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"config-frontend\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"|\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"12\",\n          children: [\"      \", _jsx(_components.span, {\n            class: \"token comment\",\n            children: \"# parse UUID [RFC 4122](https://www.rfc-editor.org/rfc/rfc4122.html)\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"13\",\n          children: [\"      http\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"request set\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"var(txn.trace_id) uuid(4)\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \",\"\n          }), \"regsub(\\\\\\\"^(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"8\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"4\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"4\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"4\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"12\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")$\\\\\\\"\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \",\"\n          }), \"\\\\\\\"\\\\1\\\\2\\\\3\\\\4\\\\5\\\\\\\")\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"14\",\n          children: [\"      http\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"request set\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"var(txn.parent_id) uuid(4)\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \",\"\n          }), \"regsub(\\\\\\\"^(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"8\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"4\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"4\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"4\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"(\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"^\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"12\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \")$\\\\\\\"\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \",\"\n          }), \"\\\\\\\"\\\\1\\\\2\\\\3\\\\\\\")\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"15\",\n          children: [\"      unique\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"id\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"format 00\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"%\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"var(txn.trace_id)\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"%\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"var(txn.parent_id)\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            class: \"token number\",\n            children: \"03\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"16\",\n          children: [\"      unique\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"id\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"header traceparent\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"17\",\n          children: [\"      \", _jsx(_components.span, {\n            class: \"token comment\",\n            children: \"# return traceparent to the client\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"18\",\n          children: [\"      http\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"after\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"response set\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \"header traceparent %ID\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's install HAProxy:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      class: \"language-bash\",\n      children: _jsxs(_components.code, {\n        class: \"language-bash code-highlight\",\n        children: [_jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"1\",\n          children: [\"helm repo \", _jsx(_components.span, {\n            class: \"token function\",\n            children: \"add\"\n          }), \" haproxy-ingress https://haproxy-ingress.github.io/charts\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"2\",\n          children: [\"helm upgrade \", _jsx(_components.span, {\n            class: \"token parameter variable\",\n            children: \"-i\"\n          }), \" haproxy haproxy-ingress/haproxy-ingress \", _jsx(_components.span, {\n            class: \"token parameter variable\",\n            children: \"-f\"\n          }), \" haproxy-traceparent.yaml\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Install \", _jsx(_components.code, {\n        children: \"podinfo\"\n      }), \" for testing,  \", _jsx(_components.code, {\n        children: \"podinfo-local.yaml:\"\n      })]\n    }), \"\\n\", _jsx(_components.pre, {\n      class: \"language-yaml\",\n      children: _jsxs(_components.code, {\n        class: \"language-yaml code-highlight\",\n        children: [_jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"1\",\n          children: [_jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"ingress\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"2\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"enabled\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token boolean important\",\n            children: \"true\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"3\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"className\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token string\",\n            children: \"\\\"haproxy\\\"\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"4\",\n          children: [\"  \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"hosts\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"5\",\n          children: [\"    \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"host\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"6\",\n          children: [\"      \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"paths\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"7\",\n          children: [\"        \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"path\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" /\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"8\",\n          children: [\"          \", _jsx(_components.span, {\n            class: \"token key atrule\",\n            children: \"pathType\"\n          }), _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \":\"\n          }), \" ImplementationSpecific\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Install:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      class: \"language-bash\",\n      children: _jsxs(_components.code, {\n        class: \"language-bash code-highlight\",\n        children: [_jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"1\",\n          children: [\"helm repo \", _jsx(_components.span, {\n            class: \"token function\",\n            children: \"add\"\n          }), \" podinfo https://stefanprodan.github.io/podinfo\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"2\",\n          children: [\"helm upgrade \", _jsx(_components.span, {\n            class: \"token parameter variable\",\n            children: \"-i\"\n          }), \" podinfo podinfo/podinfo \", _jsx(_components.span, {\n            class: \"token parameter variable\",\n            children: \"-f\"\n          }), \" podinfo-local.yaml\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Done, let's test:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      class: \"language-bash\",\n      children: _jsxs(_components.code, {\n        class: \"language-bash code-highlight\",\n        children: [_jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"1\",\n          children: [_jsx(_components.span, {\n            class: \"token function\",\n            children: \"curl\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token parameter variable\",\n            children: \"-i\"\n          }), \" http://localhost:80/headers\\n\"]\n        }), _jsx(_components.span, {\n          class: \"code-line line-number\",\n          line: \"2\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"3\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" HTTP/1.1 \", _jsx(_components.span, {\n            class: \"token number\",\n            children: \"200\"\n          }), \" OK\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"4\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" content-type: application/json\", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \";\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token assign-left variable\",\n            children: \"charset\"\n          }), _jsx(_components.span, {\n            class: \"token operator\",\n            children: \"=\"\n          }), \"utf-8\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"5\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" x-content-type-options: nosniff\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"6\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" content-length: \", _jsx(_components.span, {\n            class: \"token number\",\n            children: \"358\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"7\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" traceparent: 00-5e8097d048e64fd4a4fc1861d9032e17-6ee9491181244f5b-03\\n\"]\n        }), _jsx(_components.span, {\n          class: \"code-line line-number\",\n          line: \"8\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"9\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"10\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \"   \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"..\"\n          }), \".\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"11\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \"   \", _jsx(_components.span, {\n            class: \"token string\",\n            children: \"\\\"Traceparent\\\"\"\n          }), _jsx(_components.span, {\n            class: \"token builtin class-name\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"[\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"12\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \"     \", _jsx(_components.span, {\n            class: \"token string\",\n            children: \"\\\"00-5e8097d048e64fd4a4fc1861d9032e17-6ee9491181244f5b-03\\\"\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"13\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \"   \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"]\"\n          }), \",\\n\"]\n        }), _jsxs(_components.span, {\n          class: \"code-line line-number\",\n          line: \"14\",\n          children: [_jsx(_components.span, {\n            class: \"token operator\",\n            children: \">\"\n          }), \" \", _jsx(_components.span, {\n            class: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          class: \"code-line line-number\",\n          line: \"15\",\n          children: \"\\n\"\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Done.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","filepath":"/_content/en/haproxy-w3c-traceparent.mdx","locale":"en","slug":"haproxy-w3c-traceparent","imageHash":"1e860852ca46a9ac4e53686be3b8ed56cbbe5981"}},"locale":"en","urlPathname":"/post/haproxy-w3c-traceparent","urlParsed":{"origin":null,"pathname":"/post/haproxy-w3c-traceparent","pathnameOriginal":"/post/haproxy-w3c-traceparent","search":{},"searchAll":{},"searchOriginal":null,"hash":"","hashOriginal":null}}}</script>
      </body>
    </html>